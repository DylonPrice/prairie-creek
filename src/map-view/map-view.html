<html><head><link rel="import" href="../../bower_components/polymer/polymer.html"><link rel="import" href="../../bower_components/paper-button/paper-button.html"><link rel="import" href="../../bower_components/paper-styles/typography.html"><link rel="import" href="../../bower_components/google-map/google-map.html"><link rel="import" href="../drop-menu/drop-menu.html"><link rel="import" href="../view-behavior/view-behavior.html"><link rel="import" href="../shared-styles/shared-styles.html"><script src="../visited-icon.js"></script></head><body><dom-module id="map-view"><template><style include="shared-styles">.content{@apply (--paper-font-body1);}google-map{height:50vh;}paper-button.proceed{display:block;width:30%;margin:0 auto;}#prompt{padding-top:20px;padding-bottom:20px;}</style><div id="locationOn"><template is="dom-if" if$="[[!hideMapForTesting]]"><google-map id="map" zoom="17" latitude="[[latitude]]" longitude="[[longitude]]" click-events$="[[devMode.override]]" on-google-map-click="_debugLocation" disable-default-ui="" disable-zoom="" api-key="AIzaSyDwMK5MooS-bAAEdTq74fgxcc_GVQpd7TM"><template is="dom-repeat" items="[[locations]]" item="item"><google-map-marker class="siteMarker" latitude="[[item.latitude]]" longitude="[[item.longitude]]" icon="[[_determineIcon(item)]]"></google-map-marker></template><google-map-marker id="current" latitude="[[latitude]]" longitude="[[longitude]]"></google-map-marker></google-map></template><div id="prompt"><div class="text" id="instructions" hidden$="[[!showInstructions]]">Please visit one of these locations.</div><div class="text" id="arrival" hidden$="[[showInstructions]]">You are at the [[currentSite.name]]</div></div><paper-button class="proceed" id="proceed" raised="" on-tap="_proceed" hidden$="[[showInstructions]]">Explore</paper-button><template is="dom-if" if$="[[devMode.warp]]"><div class="debugging">Warp to:<template is="dom-repeat" items="[[locations]]" item="item"><paper-button raised="" latitude="[[item.latitude]]" longitude="[[item.longitude]]" on-tap="_warpToLocation">[[item.name]]</paper-button></template></div></template></div></template><script>Polymer({is:'map-view',behaviors:[ViewBehavior],properties:{latitude:{type:Number,notify:!0},longitude:{type:Number,notify:!0},locations:{type:Array},currentSite:{type:Object,value:null,notify:!0},devMode:{type:Object},hideMapForTesting:{type:Boolean,value:!1},showInstructions:{type:Boolean,value:!0}},observers:['_siteChanged(currentSite)'],ready:function(){this.gpsActive=!0},_determineIcon:function(a){return a.visited&&(a.icon=visitedIcon(a.icon)),a.icon},_siteChanged:function(a){this.showInstructions=!(null!=a)||a.visited},_enableLocationOverride:function(){this.$$('#map').setAttribute('click-events',!0)},_debugLocation:function(a){var b=a.detail.latLng.lat(),c=a.detail.latLng.lng();this.latitude=b,this.longitude=c},_warpToLocation:function(a){this.latitude=a.model.get('item.latitude'),this.longitude=a.model.get('item.longitude')},_proceed:function(){this.set('currentSite.visited',!0),this.showInstructions=!0,this.hideMapForTesting||(this._updateIcon(this.currentSite),this._goToView('timer'))},_updateIcon:function(a){var b=this.locations.indexOf(a),c=Polymer.dom(this.root).querySelectorAll('.siteMarker')[b];c.icon=c.icon.replace('.png','-gray.png')}});</script></dom-module></body></html>