<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">

<link rel="import" href="../drop-menu/drop-menu.html">
<link rel="import" href="../view-behavior/view-behavior.html">
<link rel="import" href="../shared-styles/shared-styles.html">

</head><body><dom-module id="map-view">
  <template>
    <style include="shared-styles">
      .content {
        @apply(--paper-font-body1);
      }

      google-map {
        height: 50vh;
      }

      paper-button.proceed {
        display: block;
        width: 30%;
        margin:0 auto;
      }

      #prompt {
        padding-top: 20px;
        padding-bottom: 20px;
      }
    </style>

    <div id="locationOn">
      <template is="dom-if" if$="[[!hideMapForTesting]]">
        <google-map id="map" zoom="6" latitude="[[latitude]]" longitude="[[longitude]]" click-events$="[[devMode.override]]" on-google-map-click="_debugLocation" api-key="AIzaSyDwMK5MooS-bAAEdTq74fgxcc_GVQpd7TM" fit-to-markers="">
          <template is="dom-repeat" items="[[locations]]" item="item">
            <google-map-marker class="siteMarker" latitude="[[item.latitude]]" longitude="[[item.longitude]]" icon="[[_determineIcon(item)]]">
            </google-map-marker>
          </template>
          <google-map-marker id="current" latitude="[[latitude]]" longitude="[[longitude]]">
          </google-map-marker>
        </google-map>
      </template>

      <div id="prompt">
        <div class="text" id="instructions" hidden$="[[!showInstructions]]">
          Please visit one of these locations.
        </div>
        <div class="text" id="arrival" hidden$="[[showInstructions]]">
          You are at the [[currentSite.name]]
        </div>
      </div>

      <paper-button class="proceed" id="proceed" raised="" on-tap="_proceed" hidden$="[[showInstructions]]">
        Explore
      </paper-button>

      <template is="dom-if" if$="[[devMode.warp]]">
        <div class="debugging">
          Warp to:
          <template is="dom-repeat" items="[[locations]]" item="item">
            <paper-button raised="" latitude="[[item.latitude]]" longitude="[[item.longitude]]" on-tap="_warpToLocation">
              [[item.name]]
            </paper-button>
          </template>
        </div>
      </template>
    </div>
  </template>
  <script>Polymer({is:"map-view",behaviors:[ViewBehavior],properties:{latitude:{type:Number,notify:!0},longitude:{type:Number,notify:!0},locations:{type:Array},currentSite:{type:Object,value:null,notify:!0},devMode:{type:Object},hideMapForTesting:{type:Boolean,value:!1},showInstructions:{type:Boolean,value:!0}},observers:["_siteChanged(currentSite)"],ready:function(){this.gpsActive=!0},_determineIcon:function(t){return t.visited&&!t.icon.includes("-gray")&&(t.icon=t.icon.replace(".png","-gray.png")),t.icon},_siteChanged:function(t){this.showInstructions=null==t||t.visited},_enableLocationOverride:function(){this.$$("#map").setAttribute("click-events",!0)},_debugLocation:function(t){var e=t.detail.latLng.lat(),i=t.detail.latLng.lng();this.latitude=e,this.longitude=i},_warpToLocation:function(t){this.latitude=t.model.get("item.latitude"),this.longitude=t.model.get("item.longitude")},_proceed:function(){this.set("currentSite.visited",!0),this.showInstructions=!0,this.hideMapForTesting||(this._updateIcon(this.currentSite),this._goToPage("timer"))},_updateIcon:function(t){var e=this.locations.indexOf(t),i=Polymer.dom(this.root).querySelectorAll(".siteMarker")[e];i.icon=i.icon.replace(".png","-gray.png")}});</script>
</dom-module>
</body></html>