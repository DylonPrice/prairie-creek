<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">

<link rel="import" href="../drop-menu/drop-menu.html">
<link rel="import" href="../view-behavior/view-behavior.html">
<link rel="import" href="../shared-styles/shared-styles.html">

</head><body><dom-module id="map-view">
  <template>
    <style include="shared-styles">
      .content {
        @apply(--paper-font-body1);
      }

      google-map {
        height: 50vh;
      }
      paper-button.proceed {
        display: block;
        width: 30%;
        margin:0 auto;
      }

      #prompt {
        padding-top: 20px;
        padding-bottom: 20px;
      }
    </style>

    <div id="locationOn" hidden$="[[!hasLatLong]]">
      <template is="dom-if" if$="[[!hideMapForTesting]]">
        <google-map id="map" zoom="6" latitude="[[latitude]]" longitude="[[longitude]]" on-google-map-click="_debugLocation" api-key="AIzaSyDwMK5MooS-bAAEdTq74fgxcc_GVQpd7TM" fit-to-markers="">
          <template is="dom-repeat" items="[[locations]]" item="item">
            <google-map-marker class="siteMarker" latitude="[[item.latitude]]" longitude="[[item.longitude]]" icon="[[_determineIcon(item)]]">
            </google-map-marker>
          </template>
          <google-map-marker id="current" latitude="[[latitude]]" longitude="[[longitude]]">
          </google-map-marker>
        </google-map>
      </template>

      <div id="prompt">
        <div class="text" id="instructions" hidden$="[[!showInstructions]]">
          Please visit one of these locations.
        </div>
        <div class="text" id="arrival" hidden$="[[showInstructions]]">
          You are at the [[currentSite.name]]
        </div>
      </div>

      <paper-button class="proceed" id="proceed" raised="" on-tap="_proceed" hidden$="[[showInstructions]]">
        Explore
      </paper-button>

      <template is="dom-if" if$="[[devMode]]">
        <div class="debugging">
          <paper-button raised="" on-tap="_enableLocationOverride">Enable Location Override</paper-button>
            <div>
              Warp to:
              <template is="dom-repeat" items="[[locations]]" item="item">
                <paper-button raised="" latitude="[[item.latitude]]" longitude="[[item.longitude]]" on-tap="_warpToLocation">
                  [[item.name]]
                </paper-button>
              </template>
            </div>
        </div>
      </template>
    </div>
    <div id="gpsmessage" hidden$="[[hasLatLong]]">
        Please Enable GPS
    </div>
  </template>
  <script>Polymer({is:"map-view",behaviors:[ViewBehavior],properties:{latitude:{type:Number,notify:!0},longitude:{type:Number,notify:!0},locations:{type:Array},currentSite:{type:Object,value:null,notify:!0},devMode:{type:Boolean,value:!1},hasLatLong:{type:Boolean,value:!1,notify:!0,computed:"_latLongDefined(latitude,longitude)"},hideMapForTesting:{type:Boolean,value:!1},showInstructions:{type:Boolean,value:!0}},observers:["_siteChanged(currentSite)"],ready:function(){this.gpsActive=!0},_determineIcon:function(e){return e.visited&&!e.icon.includes("-gray")&&(e.icon=e.icon.replace(".png","-gray.png")),e.icon},_latLongDefined:function(e,t){return e&&t},_siteChanged:function(e){this.showInstructions=null==e||e.visited},_enableLocationOverride:function(){this.$$("#map").setAttribute("click-events",!0)},_debugLocation:function(e){var t=e.detail.latLng.lat(),i=e.detail.latLng.lng();this.latitude=t,this.longitude=i},_warpToLocation:function(e){this.latitude=e.model.get("item.latitude"),this.longitude=e.model.get("item.longitude")},_proceed:function(){this.set("currentSite.visited",!0),this.showInstructions=!0,this.hideMapForTesting||(this._updateIcon(this.currentSite),this._goToPage("timer"))},_updateIcon:function(e){var t=this.locations.indexOf(e),i=Polymer.dom(this.root).querySelectorAll(".siteMarker")[t];i.icon=i.icon.replace(".png","-gray.png")}});</script>
</dom-module>
</body></html>